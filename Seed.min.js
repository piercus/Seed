if(typeof window!="undefined")var sand=window.sand={};else var sand=global.sand={};(function(e){e.env=typeof window=="undefined"?"node":"browser",Array.prototype.last=String.prototype.last=function(){return this[this.length-1]},Array.prototype.each=function(e){for(var t=-1,n=this.length;++t<n;)e(this[t],t);return this};var t=function(e){var t=[];for(var n in e)t.push(n);return t};e.grains={};var n=function(e,t,n,r){this._grains={},this.exports={},this.name=e,this.innerName=e.split("/").last(),this.requires=t,this.fn=n;if(r)for(var i in r)this[i]=r[i]};n.prototype={require:function(t){return e.getGrain(t).use(this,this)},use:function(t,n,r,i){t||(t=this),n||(n=t);if(!n._grains[this.name]){n._grains[this.name]=this;for(var s=this.requires.length;s--;){var o=this.requires[s].split("->");e.getGrain(o[0]).use(this,n,r,o[1]||null)}this.fn&&(this.exports=this.fn(this.exports)||this.exports)}return t.exports[i||this.innerName]=this.exports,this.exports}},e.getGrain=function(n){if(e.grains[n])return e.grains[n];if(n.last()==="*"){var r=n.split("/").length,i={},s=n.length-2,o=n.slice(0,s);if(e.grains[n.slice(0,n.length-2)])return e.grains[n.slice(0,n.length-2)];for(var u in this.grains)if(u.slice(0,s)===o){var a=u.split("/").slice(0,r).join("/");this.grains[a]?i[a]=!0:i[a+"/*"]=!0}return e.define(n.slice(0,n.length-2),t(i))}return e.define(n)},e.define=function(e,t,r,i){return typeof t=="function"?(r=t,t=[]):typeof t=="undefined"&&(t=[]),this.grains[e]=new n(e,t,r,i)};var r=0;e.require=function(){var t=Array.prototype.slice.call(arguments);if(t.length===1){var i=new n("require-"+ ++r);return e.grains[t[0]].use(i,i,null)}var s,o=t.last();typeof o!="function"?(s=t,o=null):s=t.slice(0,t.length-1);var i=new n("require-"+ ++r);s.each(function(t){var n=t.split("->");e.getGrain(n[0]).use(i,i,null,n[1]||null)});if(o)return o(i.exports)},e.define("sand",function(){return e}),e.global=function(t,n){if(e.env==="node")return global[t]=n;window[t]=n}})(sand),sand.define("Seed/Seed",["Seed/Eventable","Array/send"],function(e){return e.Eventable.extend({init:function(e){this._events=[],this._attached=[],this._subs=[],this._o=e,this.setOptions()},options:{},setOptions:function(){if(this.options)for(var e in this.options)this.options.hasOwnProperty(e)&&(typeof this._o[e]=="undefined"?this[e]=this.options[e]:this[e]=this._o[e])},sub:function(e,t){if(typeof e!="function")throw new Error("C is not a valid constructor");var n=new e(this._subParams(t));return this._subs.push(n),n},subParams:function(e){return e||(e={}),e._parent=this,e},destroy:function(){this.detachAll();for(var e=0;e<this._subs.length;e++)this._subs[e].destroy()}})}),sand.define("Seed/Eventable",["Seed/Extendable","Array/remove","Array/map","String/capitalize"],function(e){return e.Extendable.extend({init:function(){this._events={},this._attached=[]},fire:function(e){var t=this._events[e];if(t){var n=Array.prototype.slice.call(arguments,1);for(var r=t.length;r--;)t[r].fn.apply(t[r].subscriber,n)}},on:function(e,t,n){var r=e.split(" ");if(typeof t=="function"){var i=n;n=t,t=i}if(r.length===1)return this._on(r[0],t,n);var s=[];for(var o=0;o<r.length;o++)s[o].push(this._on(evtName,t,n));return{un:function(){for(var e=0;e<s.length;e++)s[e].un()}}},_on:function(e,t,n){if(t&&typeof t.attach!="function")throw new Error("The subscriber should have a attach(event) method");typeof n=="string"?n=t[n]:typeof n=="undefined"&&(n=t["on"+e.capitalize()]);if(typeof n!="function")throw new Error("Cannot find the function to subscribe to "+e);var r=this,i={fn:n,subscriber:t},s={un:function(){r._rmSubscription(e,i)}};return t.attach(s),(this._events[e]||(this._events[e]=[])).push(i),s},_rmSubscription:function(e,t){this._events[e].remove(t),this._events[e].length==0&&delete this._events[e]},attach:function(e){this._attached.push(e)},detachAll:function(){for(var e=0;e<this._attached.length;e++)this._attached[e].un();this._attached=[]}})}),sand.define("Seed/Extendable",[],function(e){var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},n=function(e){for(var t=1,n=arguments.length;t<n;t++){var r=typeof arguments[t]=="object"||typeof arguments[t]=="function"?arguments[t]:{};for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e},r=function(){};r.prototype.init=function(){},r["new"]=function(e,t){(typeof t[0]!="boolean"||t[0]!==!1)&&e.init.apply(e,t)};var i=function(e,t){return typeof t=="undefined"?e:typeof t=="object"&&typeof e=="object"?n({},e,t):t},s=function(e,t){return typeof e=="function"||typeof t=="function"?function(){var n=typeof e=="function"?e.apply(this,arguments):e,r=typeof t=="function"?t.apply(this,arguments):t;return i(n,r)}:i(e,t)},o=function(e,t){var n={},r=function(){};for(var i in t)if(t.hasOwnProperty(i)){var o=/(^\+|^-)(.*)/g;if(o.test(i)){var u=i.replace(o,"$2"),a=e[u]||r,f=t[i];switch(i[0]){case"+":n[u]=s(a,f);break;case"-":n[u]=s(f,a)}}else n[i]=t[i]}return n},u=function(e){var t="cstr:",n=t.length,r={instance:{},cstr:{}};for(var i in e)e.hasOwnProperty(i)&&(i.slice(0,n)===t?r.cstr[i.slice(n)]=e[i]:r.instance[i]=e[i]);return r},a=function(e,t){var r;r=function(e){r["new"].call(r,this,arguments)};var i=n({},e,o(e,t));for(var s in i)i.hasOwnProperty(s)&&(r[s]=i[s]);return r};return r.extend=function(e){var t=u(e),r=a(this,t.cstr);return r.prototype=n(new this(!1),o(this.prototype,t.instance)),r},r}),sand.define("Array/remove",function(){Array.prototype.remove=function(e){for(var t=this.length;t--;)this[t]===e&&this.splice(t,1);return this}}),sand.define("Array/map",function(){var e=this.debug;Array.prototype.map=function(t,n){n&&(t=t.bind(n));var r=this.slice();if(typeof t=="function")for(var i=0,s=r.length;i<s;i++)r[i]=t(r[i],i);else{e.i&&console.log("should not happen?"),t=t.substr(2,t.length);for(var i=0,s=r.length;i<s;i++)r[i]=r[i][t]()}return r},Array.prototype.as=function(t){return e.w&&console.log("[WARNING]: deprecated, use map instead of as"),Array.prototype.map.call(this,t)}}),sand.define("String/capitalize",function(){String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)}}),sand.define("Array/send",function(){Array.prototype.send=function(e){var t=Array.prototype.slice.call(arguments);t.splice(0,1);if(typeof e=="string")for(var n=-1,r=this.length;++n<r;)this[n][e].apply(this[n],t);else for(var n=-1,r=this.length;++n<r;)e.apply({},[this[n]].concat(t));return this}})